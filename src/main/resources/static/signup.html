<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íšŒì›ê°€ì… - Git Quiz</title>
    <style>
        /* login.htmlê³¼ ë™ì¼í•œ ìŠ¤íƒ€ì¼ */
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f9f9f9; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .auth-container { background: white; padding: 40px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); width: 100%; max-width: 400px; text-align: center; }
        
        .auth-form input { width: 100%; padding: 12px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        .auth-btn { width: 100%; padding: 12px; background-color: #00664F; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 1rem; }
        .auth-btn:hover { background-color: #0056b3; }

        .switch-link { margin-top: 20px; font-size: 14px; color: #555; }
        .switch-link a { color: #00664F; font-weight: bold; text-decoration: none; }
    </style>
</head>
<body>

<div class="auth-container">
    <h2 style="color:#00664F; margin-bottom: 20px;">íšŒì›ê°€ì…</h2>

    <div class="auth-form">
        <input type="text" id="newId" placeholder="ì•„ì´ë”” (ë¡œê·¸ì¸ìš©)" required>
        <input type="password" id="newPw" placeholder="ë¹„ë°€ë²ˆí˜¸" required>
        <input type="text" id="newNickname" placeholder="ë‹‰ë„¤ì„ (ê²Œì„ í‘œì‹œìš©)" required>
        
        <button class="auth-btn" onclick="handleSignup()">ê°€ì… ì™„ë£Œ</button>
    </div>

    <p class="switch-link">
        ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”?
        <a href="login.html">ë¡œê·¸ì¸ í•˜ëŸ¬ê°€ê¸°</a>
    </p>
</div>

<script>
    async function handleSignup() {
        // 1. ë¡œê·¸ì¸ í˜ì´ì§€ì—ì„œ ì €ì¥ëœ IP ê°€ì ¸ì˜¤ê¸°
        let ip = sessionStorage.getItem('serverIP');
        
        // ë§Œì•½ IPê°€ ì—†ë‹¤ë©´? (ë°”ë¡œ íšŒì›ê°€ì… í˜ì´ì§€ë¡œ ë“¤ì–´ì˜¨ ê²½ìš°)
        if (!ip) {
            ip = prompt("ì„œë²„ IP ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš” (ì˜ˆ: localhost:8080)", "localhost:8080");
            if(ip) sessionStorage.setItem('serverIP', ip);
            else return;
        }

        const id = document.getElementById('newId').value;
        const pw = document.getElementById('newPw').value;
        const nickname = document.getElementById('newNickname').value;

        if (!id || !pw || !nickname) {
            alert("ëª¨ë“  ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return;
        }

        try {
            // 2. ì„œë²„ë¡œ íšŒì›ê°€ì… ìš”ì²­
            const response = await fetch(`http://${ip}/api/signup`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                // ë°±ì—”ë“œ Map<String, String> í‚¤ê°’ê³¼ ì¼ì¹˜í•´ì•¼ í•¨
                body: JSON.stringify({ id: id, pw: pw, nickname: nickname }) 
            });

            if (response.ok) {
                const result = await response.text();
                if (result === "SUCCESS") {
                    alert("ğŸ‰ íšŒì›ê°€ì… ì„±ê³µ! ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.");
                    location.href = 'index.html';
                } else {
                    alert("âŒ ì‹¤íŒ¨: " + result); // ì˜ˆ: ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ID
                }
            } else {
                alert(`âš ï¸ ì„œë²„ ì˜¤ë¥˜ (ì½”ë“œ: ${response.status})`);
            }
        } catch (error) {
            console.error(error);
            alert("â›” ì„œë²„ ì—°ê²° ì‹¤íŒ¨! IPë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.");
        }
    }
</script>

</body>
</html>