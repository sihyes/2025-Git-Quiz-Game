<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¡œê·¸ì¸</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="./css/style.css">
</head>
<body>

<div class="auth-container">
    <h2 style="color:#00664F; margin-bottom: 20px;">Git Quiz! ë¡œê·¸ì¸</h2>

    <div class="server-settings">
        <label for="serverIP">ğŸ”Œ ì„œë²„ ì£¼ì†Œ (IP:Port)</label>
        <input type="text" id="serverIP" placeholder="ì˜ˆ: 192.168.0.5:8080">
    </div>

    <div class="auth-form">
        <input type="text" id="userId" placeholder="ì•„ì´ë””" required>
        <input type="password" id="userPw" placeholder="ë¹„ë°€ë²ˆí˜¸" required>
        <button class="auth-btn" onclick="handleLogin()">ë¡œê·¸ì¸ & ì ‘ì†</button>
    </div>
    <p class="switch-link">
        ì•„ì§ ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”?
        <a href="signup.html">íšŒì›ê°€ì… í•˜ê¸°</a>
    </p>
</div>

<script>
    async function handleLogin() {
        const ip = document.getElementById('serverIP').value;
        const id = document.getElementById('userId').value;
        const pw = document.getElementById('userPw').value;

        if (!ip) {
            alert("ì„œë²„ IPë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return;
        }
        
        if (!id) {
            alert("ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return;
        }
        
        if (!pw) {
            alert("íŒ¨ìŠ¤ì›Œë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return;
        }

        // 1. IPì™€ IDë¥¼ ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥ (ë‹¤ë¥¸ í˜ì´ì§€ì—ì„œ ì“°ê¸° ìœ„í•´)
        sessionStorage.setItem('serverIP', ip);
        sessionStorage.setItem('userID', id); // ë‹‰ë„¤ì„ ëŒ€ìš©

        // 2. ì„œë²„ë¡œ ìš”ì²­ ë³´ë‚´ë³´ê¸°
        try {
            // (1) fetch ìš”ì²­ ì‹œë„
            const response = await fetch(`http://${ip}/api/login`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ id: id, pw: pw }) // ë°±ì—”ë“œ AuthControllerê°€ ë°›ëŠ” í‚¤ ì´ë¦„ê³¼ ë§ì¶°ì•¼ í•¨
            });

            // (2) ì„œë²„ ì‘ë‹µ ì²˜ë¦¬
            if (response.ok) {
                const result = await response.text();
                
                if (result.startsWith("SUCCESS")) {
                    const nickname = result.split(":")[1];
                    sessionStorage.setItem('userID', id);
                    sessionStorage.setItem('nickname', nickname);
                    
                    alert("ë¡œê·¸ì¸ ì„±ê³µ! í™˜ì˜í•©ë‹ˆë‹¤ ğŸ˜Š");
                    location.href = 'lobby.html'; 
                } else {
                    // ì„œë²„ëŠ” ì¼œì ¸ìˆëŠ”ë° ë¹„ë²ˆì´ í‹€ë¦° ê²½ìš°
                    alert("âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨: " + result); 
                }
            } else {
                // ì„œë²„ ì—ëŸ¬ (500) ë˜ëŠ” ê²½ë¡œ ì—†ìŒ (404)
                alert(`âš ï¸ ì„œë²„ ì˜¤ë¥˜ ë°œìƒ (ì½”ë“œ: ${response.status})\nì„œë²„ ë¡œê·¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.`);
            }

        } catch (error) {
            // (3) ì•„ì˜ˆ ì—°ê²°ì¡°ì°¨ ì•ˆ ë  ë•Œ (ì„œë²„ êº¼ì§, IP í‹€ë¦¼)
            console.error(error);
            alert("â›” ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n\n1. ì…ë ¥í•œ IPê°€ ì •í™•í•œì§€ í™•ì¸í•˜ì„¸ìš”.\n2. ì„œë²„(ì´í´ë¦½ìŠ¤)ê°€ ì¼œì ¸ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.\n3. ê°™ì€ ì™€ì´íŒŒì´ì— ì ‘ì†í–ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.");
        }
    }
</script>

</body>
</html>